<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Face Center Clicker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            margin: 0;
            padding: 20px;
        }

        .header {
            position: sticky;
            top: 0;
            background: #2a2a2a;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            z-index: 100;
        }

        .progress {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .instructions {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
        }

        button:hover {
            background: #45a049;
        }

        button.secondary {
            background: #2196F3;
        }

        button.secondary:hover {
            background: #0b7dda;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .character-card {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s;
        }

        .character-card:hover {
            transform: scale(1.02);
        }

        .character-card.completed {
            background: #1a4d1a;
            border: 2px solid #4CAF50;
        }

        .character-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: capitalize;
        }

        .image-container {
            position: relative;
            display: inline-block;
            cursor: crosshair;
            border: 2px solid #444;
            border-radius: 5px;
            overflow: hidden;
        }

        .character-card.completed .image-container {
            border-color: #4CAF50;
        }

        .character-image {
            display: block;
            width: 250px;
            height: 250px;
        }

        .click-marker {
            position: absolute;
            width: 10px;
            height: 10px;
            background: red;
            border: 2px solid white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .coordinates {
            margin-top: 8px;
            font-size: 12px;
            color: #aaa;
        }

        .character-card.completed .coordinates {
            color: #4CAF50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="progress">
            <span id="completed">0</span> / <span id="total">0</span> characters completed
        </div>

        <div class="instructions">
            <strong>Instructions:</strong> Click on the center of each character's face (nose area preferred).
            For characters without visible features (helmets, etc.), click the center of their head.
            For multi-character images, click between all characters' faces.
        </div>

        <div class="controls">
            <button onclick="exportData()">Export Data (Copy to Clipboard)</button>
            <button class="secondary" onclick="loadFromClipboard()">Load From Clipboard</button>
            <button class="secondary" onclick="clearAll()">Clear All</button>
        </div>
    </div>

    <div class="grid" id="character-grid"></div>

    <script>'use strict';
        const IMAGE_DIR = '../assets/images/games/ssbu/professor_fandango/';

        // Will be populated by scanning the directory
        let characters = [];

        // Multi-character fighters
        const multiCharacterFighters = {
            'ice_climbers': 2,
            'banjo_kazooie': 2,
            'pyra_mythra': 2,
            'rosalina_luma': 2,
            'duck_hunt': 2,
            'pokemon_trainer': 3,
            'mii_fighters': 3
        };

        // Store click data
        let clickData = {};

        // Load saved data from localStorage
        function loadSavedData() {
            const saved = localStorage.getItem('characterFaceClicks');
            if (saved) {
                try {
                    clickData = JSON.parse(saved);
                    updateProgress();
                } catch (e) {
                    console.error('Failed to load saved data:', e);
                }
            }
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('characterFaceClicks', JSON.stringify(clickData));
            updateProgress();
        }

        // Update progress counter
        function updateProgress() {
            const completed = Object.keys(clickData).length;
            document.getElementById('completed').textContent = completed;
            document.getElementById('total').textContent = characters.length;
        }

        // Handle image click
        function handleImageClick(characterName, event) {
            const rect = event.target.getBoundingClientRect();
            const x = Math.round(event.clientX - rect.left);
            const y = Math.round(event.clientY - rect.top);

            // Store click data
            clickData[characterName] = { x, y };
            saveData();

            // Update UI
            updateCharacterCard(characterName, x, y);
        }

        // Update character card UI
        function updateCharacterCard(characterName, x, y) {
            const card = document.getElementById(`card-${characterName}`);
            const container = card.querySelector('.image-container');

            // Remove existing marker
            const existingMarker = container.querySelector('.click-marker');
            if (existingMarker) {
                existingMarker.remove();
            }

            // Add new marker
            const marker = document.createElement('div');
            marker.className = 'click-marker';
            marker.style.left = x + 'px';
            marker.style.top = y + 'px';
            container.appendChild(marker);

            // Update coordinates display
            const coordsEl = card.querySelector('.coordinates');
            coordsEl.textContent = `x: ${x}, y: ${y}`;

            // Mark as completed
            card.classList.add('completed');
        }

        // Export data
        function exportData() {
            const output = {
                ...clickData
            };

            const jsonString = JSON.stringify(output, null, 2);

            // Copy to clipboard
            navigator.clipboard.writeText(jsonString).then(() => {
                alert('Data copied to clipboard! Save this to face_centers.json');
            }).catch(err => {
                console.error('Failed to copy:', err);
                // Fallback: show in alert
                alert('Copy this data:\n\n' + jsonString);
            });
        }

        // Load from clipboard
        function loadFromClipboard() {
            navigator.clipboard.readText().then(text => {
                try {
                    const data = JSON.parse(text);
                    clickData = data;
                    saveData();

                    // Update all cards
                    Object.entries(data).forEach(([char, coords]) => {
                        updateCharacterCard(char, coords.x, coords.y);
                    });

                    alert('Data loaded successfully!');
                } catch (e) {
                    alert('Failed to parse clipboard data. Make sure it\'s valid JSON.');
                }
            });
        }

        // Clear all data
        function clearAll() {
            if (confirm('Are you sure you want to clear all click data?')) {
                clickData = {};
                localStorage.removeItem('characterFaceClicks');
                location.reload();
            }
        }

        // Load all images from directory
        async function loadImagesFromDirectory() {
            try {
                // Fetch the directory listing
                const response = await fetch(IMAGE_DIR);
                const text = await response.text();

                // Parse HTML to find .jpg files
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                const links = doc.querySelectorAll('a');

                const imageFiles = [];
                links.forEach(link => {
                    const href = link.getAttribute('href');
                    if (href && href.endsWith('.jpg')) {
                        const charName = href.replace('.jpg', '');
                        imageFiles.push(charName);
                    }
                });

                if (imageFiles.length === 0) {
                    throw new Error('No images found');
                }

                characters = imageFiles.sort();
                console.log(`Loaded ${characters.length} characters`);

            } catch (error) {
                console.error('Failed to load from directory:', error);
                // Fallback to hardcoded list
                characters = [
                    'banjo_kazooie', 'bayonetta', 'bowser', 'bowser_jr', 'byleth',
                    'captain_falcon', 'chrom', 'cloud', 'corrin', 'daisy',
                    'dark_pit', 'dark_samus', 'diddy_kong', 'donkey_kong', 'dr_mario',
                    'duck_hunt', 'falco', 'fox', 'ganondorf', 'greninja',
                    'hero', 'ice_climbers', 'ike', 'incineroar', 'inkling',
                    'isabelle', 'jigglypuff', 'joker', 'kazuya', 'ken',
                    'king_dedede', 'king_k_rool', 'kirby', 'link', 'little_mac',
                    'lucario', 'lucas', 'lucina', 'luigi', 'mario',
                    'marth', 'mega_man', 'meta_knight', 'mewtwo', 'mii_fighters',
                    'min_min', 'mr_game_watch', 'ness', 'olimar', 'pac_man',
                    'palutena', 'peach', 'pichu', 'pikachu', 'piranha_plant',
                    'pit', 'pokemon_trainer', 'pyra_mythra', 'r_o_b', 'richter',
                    'ridley', 'robin', 'rosalina_luma', 'roy', 'ryu',
                    'samus', 'sephiroth', 'sheik', 'shulk', 'simon',
                    'snake', 'sonic', 'sora', 'steve', 'terry',
                    'toon_link', 'villager', 'wario', 'wii_fit_trainer', 'wolf',
                    'yoshi', 'young_link', 'zelda', 'zero_suit_samus'
                ];
                console.log('Using fallback character list');
            }
        }

        // Initialize grid
        function initializeGrid() {
            const grid = document.getElementById('character-grid');

            characters.forEach(charName => {
                const card = document.createElement('div');
                card.className = 'character-card';
                card.id = `card-${charName}`;

                const displayName = charName.replace(/_/g, ' ');
                const numChars = multiCharacterFighters[charName] || 1;
                const subtitle = numChars > 1 ? ` (${numChars} characters)` : '';

                card.innerHTML = `
                    <div class="character-name">${displayName}${subtitle}</div>
                    <div class="image-container">
                        <img
                            class="character-image"
                            src="${IMAGE_DIR}${charName}.jpg"
                            alt="${displayName}"
                            onclick="handleImageClick('${charName}', event)"
                            onerror="this.parentElement.parentElement.style.display='none'"
                        />
                    </div>
                    <div class="coordinates">Click on face center</div>
                `;

                grid.appendChild(card);

                // If already clicked, restore marker
                if (clickData[charName]) {
                    updateCharacterCard(charName, clickData[charName].x, clickData[charName].y);
                }
            });

            updateProgress();
        }

        // Initialize on load
        async function init() {
            loadSavedData();
            await loadImagesFromDirectory();
            initializeGrid();
        }

        init();
    </script>
</body>
</html>
